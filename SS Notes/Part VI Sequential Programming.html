<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Part VI Sequential Programming</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="github-pandoc.css" />
</head>
<body>
<header>
<h1 class="title">Part VI Sequential Programming</h1>
</header>
<p>The three big ideas in this part are <em>effect</em>, <em>sequence</em>, and <em>state</em>.</p>
<p><strong>What is <em>effect</em>?</strong></p>
<p>In this part of the book we’re going to talk about giving commands to the computer as well as asking it questions. That is, we’ll invoke procedures that tell Scheme to do something. Instead of merely computing a value, such a procedure has an <em>effect</em>, an action that changes something.</p>
<p><strong>What is <em>sequence</em>?</strong></p>
<p>Once we’re thinking about actions, it’s very natural to consider a <em>sequence</em> of actions. First cooking dinner, then eating, and then washing the dishes is one sequence.</p>
<p><strong>What is <em>sequential programming</em>?</strong></p>
<p>Most books compare a program to a recipe or a sequence of instructions, along the lines of</p>
<pre><code>to go-to-work
  get-dressed
  eat-breakfast
  catch-the-bus</code></pre>
<p>This <em>sequential programming</em> style is simple and natural, and it does a good job of modeling computations in which the problem concerns a sequence of events. If you’re writing an airline reservation system, a sequential program with <code>reserve-seat</code> and <code>issue-ticket</code> commands makes sense. But if you want to know the acronym of a phrase, that’s not inherently sequential, and a question-asking approach is best.</p>
<p><strong>What is <em>state</em>?</strong></p>
<p>Some actions that Scheme can take affect the “outside” world, such as printing something on the computer screen. But Scheme can also carry out internal actions, invisible outside the computer, but changing the environment in which Scheme itself carries out computations. Defining a new variable with <code>define</code> is an example; before the definition, Scheme wouldn’t understand what that name means, but once the definition has been made, the name can be used in evaluating later expressions.</p>
<p>Scheme’s knowledge about the leftover effects of past computations is called its <em>state</em>. The third big idea in this part of the book is that <em>we can write programs that maintain state information and use it to determine their results.</em></p>
<p><strong>How does the notion of <em>sequence</em> and <em>state</em> contradict functional programming?</strong></p>
<p>Like <em>sequence</em>, the notion of <em>state</em> contradicts functional programming. Earlier in the book, we emphasized that every time a function is invoked with the same arguments, it must return the same value. But a procedure whose returned value depends on <em>state</em>—on the past history of the computation—might return a different value on each invocation, even with identical arguments.</p>
<p><strong>What are the three useful situations for <em>effects</em>, <em>sequence</em> and <em>state</em>?</strong></p>
<ul>
<li>Interactive, question-and-answer programs that involve keyboard input while the com- putation is in progress;</li>
<li>Programs that must read and write long-term data file storage;</li>
<li>Computations that model an actual sequence of events in time and use the state of the program to model information about the state of the simulated events.</li>
</ul>
<p>After introducing Scheme’s mechanisms for sequential programming, we’ll use those mechanisms to implement versions of two commonly used types of business computer applications, a spreadsheet and a database program.</p>
<hr />
<h2 id="chapter-20-input-and-output">Chapter 20 Input and Output</h2>
<h3 id="printing">Printing</h3>
<p><strong>How to print the lyrics of “99 Bottles of Beer on the Wall” with scheme?</strong></p>
<p>We’ll write a program to print a verse, rather than return it in a list:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb2-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(bottles n)</a>
<a class="sourceLine" id="cb2-2" title="2">  (<span class="kw">if</span> (<span class="op">=</span> n <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">      &#39;burp</a>
<a class="sourceLine" id="cb2-4" title="4">      (<span class="kw">begin</span> (verse n)</a>
<a class="sourceLine" id="cb2-5" title="5">             (bottles (<span class="op">-</span> n <span class="dv">1</span>)))))</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">(<span class="ex">define</span><span class="fu"> </span>(verse n)</a>
<a class="sourceLine" id="cb2-8" title="8">(show (<span class="kw">cons</span> n &#39;(bottles of beer on the wall)))</a>
<a class="sourceLine" id="cb2-9" title="9">(show (<span class="kw">cons</span> n &#39;(bottles of beer)))</a>
<a class="sourceLine" id="cb2-10" title="10">(show &#39;(<span class="kw">if</span> one of those bottles should happen to fall))</a>
<a class="sourceLine" id="cb2-11" title="11">(show (<span class="kw">cons</span> (<span class="op">-</span> n <span class="dv">1</span>) &#39;(bottles of beer on the wall)))</a>
<a class="sourceLine" id="cb2-12" title="12">(show &#39;()))</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14">(bottles <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">; (3 BOTTLES OF BEER ON THE WALL)</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">; (3 BOTTLES OF BEER)</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">; (IF ONE OF THOSE BOTTLES SHOULD HAPPEN TO FALL)</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">; (2 BOTTLES OF BEER ON THE WALL)</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">; ()</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">; (2 BOTTLES OF BEER ON THE WALL)</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">; (2 BOTTLES OF BEER)</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co">; (IF ONE OF THOSE BOTTLES SHOULD HAPPEN TO FALL)</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co">; (1 BOTTLES OF BEER ON THE WALL)</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">; ()</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">; (1 BOTTLES OF BEER ON THE WALL)</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">; (1 BOTTLES OF BEER)</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">; (IF ONE OF THOSE BOTTLES SHOULD HAPPEN TO FALL)</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">; (0 BOTTLES OF BEER ON THE WALL)</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">; ()</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">; BURP</span></a></code></pre></div>
<p>Why was “burp” printed at the end? Just because we’re printing things explicitly doesn’t mean that the read-eval-print loop stops functioning. We typed the expression <code>(bottles 3)</code> . In the course of evaluating that expression, Scheme printed several lines for us. But the value of the expression was the word burp, because that’s what bottles returned.</p>
<hr />
<h3 id="side-effects-and-sequencing">Side Effects and Sequencing</h3>
<p><strong>How does procedure <code>show</code> work?</strong></p>
<p>The procedures we’ve used compute and return a value, and do nothing else. <code>show</code> is different. Although every Scheme procedure returns a value, <em>the Scheme language standard doesn’t specify what value the printing procedures should return</em>. Instead, we are interested in their side effects. <em>we invoke show because we want it to do something, namely, print its argument on the screen.</em></p>
<p>Suppose <code>show</code> returns <code>#f</code> in your version of Scheme. Then you might see</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb3-1" title="1">(show <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">; 7</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">; #F</span></a></code></pre></div>
<p>But since the return value is unspecified, we try to write programs in such a way that <em>we never use <code>show</code>’s return value as the return value from our procedures.</em></p>
<p><strong>What is “side effect”?</strong></p>
<p>What exactly do we mean by “side effect”? The kinds of procedures that we’ve used before this chapter can compute values, invoke helper procedures, provide arguments to the helper procedures, and return a value. There may be a lot of activity going on within the procedure, but the procedure affects the world outside of itself only by returning a value that some other procedure might use. <code>show</code> affects the world outside of itself by putting something on the screen. After show has finished its work, someone who looks at the screen can tell that show was used.</p>
<p>The term <em>side effect</em> is based on the idea that a procedure may have a useful return value as its main purpose and may also have an effect “on the side.” It’s a misnomer to talk about the side effect of <code>show</code>, since the effect is its main purpose.</p>
<p><strong>What is the difference between values and effects?</strong></p>
<p>Here’s an example to illustrate the difference between values and effects:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb4-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(effect x)</a>
<a class="sourceLine" id="cb4-2" title="2">  (show x)</a>
<a class="sourceLine" id="cb4-3" title="3">  &#39;done)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">(<span class="ex">define</span><span class="fu"> </span>(value x)</a>
<a class="sourceLine" id="cb4-6" title="6">  x)</a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8">(effect &#39;(oh! darling))</a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">; (OH! DARLING)</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">; DONE</span></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12">(value &#39;(oh! darling))</a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">; (OH! DARLING)</span></a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15">(bf (effect &#39;(oh! darling)))</a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">; (OH! DARLING)</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">; ONE</span></a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19">(bf (value &#39;(oh! darling)))</a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">; (DARLING)</span></a>
<a class="sourceLine" id="cb4-21" title="21"></a>
<a class="sourceLine" id="cb4-22" title="22">(<span class="ex">define</span><span class="fu"> </span>(lots-of-effect x)</a>
<a class="sourceLine" id="cb4-23" title="23">  (effect x)</a>
<a class="sourceLine" id="cb4-24" title="24">  (effect x)</a>
<a class="sourceLine" id="cb4-25" title="25">  (effect x))</a>
<a class="sourceLine" id="cb4-26" title="26"></a>
<a class="sourceLine" id="cb4-27" title="27">(<span class="ex">define</span><span class="fu"> </span>(lots-of-value x)</a>
<a class="sourceLine" id="cb4-28" title="28">  (value x)</a>
<a class="sourceLine" id="cb4-29" title="29">  (value x)</a>
<a class="sourceLine" id="cb4-30" title="30">  (value x))</a>
<a class="sourceLine" id="cb4-31" title="31"></a>
<a class="sourceLine" id="cb4-32" title="32">(lots-of-effect &#39;(oh! darling))</a>
<a class="sourceLine" id="cb4-33" title="33"><span class="co">; (OH! DARLING)</span></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">; (OH! DARLING)</span></a>
<a class="sourceLine" id="cb4-35" title="35"><span class="co">; (OH! DARLING)</span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="co">; DONE</span></a>
<a class="sourceLine" id="cb4-37" title="37"></a>
<a class="sourceLine" id="cb4-38" title="38">(lots-of-value ’(oh! darling))</a>
<a class="sourceLine" id="cb4-39" title="39"><span class="co">; (OH! DARLING)</span></a></code></pre></div>
<p>This example also demonstrates the second new idea, <em>sequencing</em>: Each of <code>effect</code>, <code>lots-of-effect</code>, and <code>lots-of-value</code> contains more than one expression in its body. When you invoke such a procedure, <em>Scheme evaluates all the expressions in the body, in order, and returns the value of the last one.</em> This also works in the body of a <code>let</code>, which is really the body of a procedure, and in each clause of a <code>cond</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb5-1" title="1">(<span class="kw">cond</span> ((<span class="op">&lt;</span> <span class="dv">4</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">       (show &#39;(how interesting))</a>
<a class="sourceLine" id="cb5-3" title="3">       (show &#39;(<span class="dv">4</span> is less than <span class="kw">zero?</span>))</a>
<a class="sourceLine" id="cb5-4" title="4">       <span class="dv">#f</span>)</a>
<a class="sourceLine" id="cb5-5" title="5">      ((<span class="op">&gt;</span> <span class="dv">4</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb5-6" title="6">       (show &#39;(more reasonable))</a>
<a class="sourceLine" id="cb5-7" title="7">       (show &#39;(<span class="dv">4</span> really is more than zero))</a>
<a class="sourceLine" id="cb5-8" title="8">       &#39;value)</a>
<a class="sourceLine" id="cb5-9" title="9">      (<span class="kw">else</span></a>
<a class="sourceLine" id="cb5-10" title="10">       (show &#39;(you mean <span class="dv">4</span>=<span class="dv">0</span>?))</a>
<a class="sourceLine" id="cb5-11" title="11">       <span class="dv">#f</span>))</a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">; (MORE REASONABLE)</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">; (4 REALLY IS MORE THAN ZERO)</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">; VALUE</span></a></code></pre></div>
<blockquote>
<p>In Chapter 4, we said that the body of a procedure was always one single expression. We lied. <em>But as long as you don’t use any procedures with side effects, it doesn’t do you any good to evaluate more than one expression in a body.</em></p>
</blockquote>
<p>When we invoked <code>lots-of-value</code>, Scheme invoked <code>value</code> three times; it discarded the values returned by the first two invocations, and returned the value from the third invocation. Similarly, when we invoked <code>lots-of-effect</code>, Scheme invoked <code>effect</code> three times and returned the value from the third invocation. But each invocation of <code>effect</code> caused its argument to be printed by invoking <code>show</code>.</p>
<hr />
<h3 id="the-begin-special-form">The <code>begin</code> Special Form</h3>
<p><strong>Why is that multiple expressions can’t be used in an <code>if</code> construction?</strong></p>
<p>The <code>lots-of-effect</code> procedure accomplished sequencing by having more than one expression in its body. This works fine if the sequence of events that you want to perform is the entire body of a procedure. But in <code>bottles</code> we wanted to include a sequence as one of the alternatives in an <code>if</code> construction. We couldn’t just say</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb6-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(bottles n)</a>
<a class="sourceLine" id="cb6-2" title="2">  (<span class="kw">if</span> (<span class="op">=</span> n <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb6-3" title="3">      &#39;()</a>
<a class="sourceLine" id="cb6-4" title="4">      (verse n)</a>
<a class="sourceLine" id="cb6-5" title="5">      (bottles (<span class="op">-</span> n <span class="dv">1</span>))))</a></code></pre></div>
<p>because <code>if</code> must have exactly three arguments. Otherwise, how would <code>if</code> know whether we meant <code>(verse n)</code> to be the second expression in the true case, or the first expression in the false case?</p>
<p><strong>How does <code>begin</code> work?</strong></p>
<p>Instead, to turn the sequence of expressions into a single expression, we use the special form <code>begin</code>. <em>It takes any number of arguments, evaluates them from left to right, and returns the value of the last one.</em></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb7-1" title="1">(<span class="ex">define</span><span class="fu"> bottles </span>n)</a>
<a class="sourceLine" id="cb7-2" title="2">(<span class="kw">if</span> (<span class="op">=</span> n <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb7-3" title="3">’burp</a>
<a class="sourceLine" id="cb7-4" title="4">(<span class="kw">begin</span> (verse n)</a>
<a class="sourceLine" id="cb7-5" title="5">(bottles (<span class="op">-</span> n <span class="dv">1</span>)))))</a></code></pre></div>
<p>(One way to think about sequences in procedure bodies is that every procedure body has an invisible <code>begin</code> surrounding it.)</p>
<hr />
<h3 id="this-isnt-functional-programming">This isn’t Functional Programming</h3>
<p><strong>What is the difference between a function and procedure?</strong></p>
<p>Sequencing and side effects are radical departures from the idea of functional programming. In fact, we’d like to reserve the name <em>function</em> for something that computes and returns one value, with no side effects.</p>
<p>“<em>Procedure</em>” is the general term for the thing that lambda returns—an embodiment of an algorithm. If the algorithm is the kind that computes and returns a single value without side effects, then we say that the procedure implements a function.</p>
<blockquote>
<p>Sometimes people sloppily say that the procedure is a function. In fact, you may hear people be really sloppy and call a non-functional procedure a function!</p>
</blockquote>
<p><strong>Is there sequencing in functional programming?</strong></p>
<p>There is a certain kind of sequencing even in functional programming. If you say</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb8-1" title="1">(* (<span class="op">+</span> <span class="dv">3</span> <span class="dv">4</span>) (<span class="op">-</span> <span class="dv">92</span> <span class="dv">15</span>))</a></code></pre></div>
<p>it’s clear that the addition has to happen before the multiplication, because the result of the addition provides one of the arguments to the multiplication.</p>
<p>What’s new in the sequential programming style is the emphasis on <em>sequence</em>, and the fact that the expressions in the sequence are independent instead of contributing values to each other. In this multiplication problem, for example, we don’t care whether the addition happens before or after the subtraction. If the addition and subtraction were in a sequence, we’d be using them for independent purposes:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb9-1" title="1">(<span class="kw">begin</span></a>
<a class="sourceLine" id="cb9-2" title="2"> (show (<span class="op">+</span> <span class="dv">3</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb9-3" title="3"> (show (<span class="op">-</span> <span class="dv">92</span> <span class="dv">15</span>)))</a></code></pre></div>
<p>This is what we mean by being independent. <em>Neither expression helps in computing the other. And the order matters because we can see the order in which the results are printed.</em></p>
<hr />
<h3 id="not-moving-to-the-next-line">Not Moving to the Next Line</h3>
<p><strong>How to make a program print several things on the same line?</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb10-1" title="1">(<span class="kw">begin</span> (show-addition <span class="dv">3</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb10-2" title="2">       (show-addition <span class="dv">6</span> <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb10-3" title="3">       &#39;done)</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co">; 3+4=7</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co">; 6+8=14</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="co">; DONE</span></a></code></pre></div>
<p>We use <code>display</code>, which doesn’t move to the next line after printing its argument:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb11-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(show-addition x y)</a>
<a class="sourceLine" id="cb11-2" title="2">  (<span class="kw">display</span> x)</a>
<a class="sourceLine" id="cb11-3" title="3">  (<span class="kw">display</span> &#39;+)</a>
<a class="sourceLine" id="cb11-4" title="4">  (<span class="kw">display</span> y)</a>
<a class="sourceLine" id="cb11-5" title="5">  (<span class="kw">display</span> &#39;=)</a>
<a class="sourceLine" id="cb11-6" title="6">  (show (<span class="op">+</span> x y)))</a></code></pre></div>
<p>(The last one is a show because we do want to start a new line after it.)</p>
<p><strong>How to print a blank line?</strong></p>
<p>You use <code>newline</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb12-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(verse n)</a>
<a class="sourceLine" id="cb12-2" title="2">  (show (<span class="kw">cons</span> n &#39;(bottles of beer on the wall)))</a>
<a class="sourceLine" id="cb12-3" title="3">  (show (<span class="kw">cons</span> n &#39;(bottles of beer)))</a>
<a class="sourceLine" id="cb12-4" title="4">  (show &#39;(<span class="kw">if</span> one of those bottles should happen to fall))</a>
<a class="sourceLine" id="cb12-5" title="5">  (show (<span class="kw">cons</span> (<span class="op">-</span> n <span class="dv">1</span>) &#39;(bottles of beer on the wall)))</a>
<a class="sourceLine" id="cb12-6" title="6">  (<span class="kw">newline</span>))                                                       <span class="co">; replaces (show &#39;())</span></a></code></pre></div>
<p>In fact, <code>show</code> isn’t an official Scheme primitive; we wrote it in terms of <code>display</code> and <code>newline</code> .</p>
<hr />
<h3 id="strings">Strings</h3>
<p><strong>What are strings?</strong></p>
<p><em>Strings</em> are words enclosed in double-quote marks so that Scheme will permit the use of punctuation or other unusual characters. Strings also preserve the case of letters, so they can be used to beautify our song even more.</p>
<p><strong>How to beautify “99 Bottles of Beer on the Wall” with strings?</strong></p>
<p>Since any character can be in a string, including spaces, the easiest thing to do in this case is to treat all the letters, spaces, and punctuation characters of each line of the song as one long word.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb13-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(verse n)</a>
<a class="sourceLine" id="cb13-2" title="2">  (<span class="kw">display</span> n)</a>
<a class="sourceLine" id="cb13-3" title="3">  (show <span class="st">&quot; bottles of beer on the wall,&quot;</span>)</a>
<a class="sourceLine" id="cb13-4" title="4">  (<span class="kw">display</span> n)</a>
<a class="sourceLine" id="cb13-5" title="5">  (show <span class="st">&quot; bottles of beer.&quot;</span>)</a>
<a class="sourceLine" id="cb13-6" title="6">  (show <span class="st">&quot;If one of those bottles should happen to fall,&quot;</span>)</a>
<a class="sourceLine" id="cb13-7" title="7">  (<span class="kw">display</span> (<span class="op">-</span> n <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb13-8" title="8">  (show <span class="st">&quot; bottles of beer on the wall.&quot;</span>)</a>
<a class="sourceLine" id="cb13-9" title="9">  (<span class="kw">newline</span>))</a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11">(verse <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">; 6 bottles of beer on the wall,</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">; 6 bottles of beer.</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">; If one of those bottles should happen to fall,</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="co">; 5 bottles of beer on the wall.</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">; #F                                             ; or whatever is returned by (newline)</span></a></code></pre></div>
<p>It’s strange to think of “bottles of beer on the wall,” as a single word. But <em>the rule is that anything inside double quotes counts as a single word. It doesn’t have to be an English word.</em></p>
<hr />
<h3 id="a-higher-order-procedure-for-sequencing">A Higher-Order Procedure for Sequencing</h3>
<p><strong>How to print each element of a list?</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb14-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(show-list lst)</a>
<a class="sourceLine" id="cb14-2" title="2">  (<span class="kw">if</span> (<span class="kw">null?</span> lst)</a>
<a class="sourceLine" id="cb14-3" title="3">      &#39;done</a>
<a class="sourceLine" id="cb14-4" title="4">      (<span class="kw">begin</span> (show (<span class="kw">car</span> lst))</a>
<a class="sourceLine" id="cb14-5" title="5">             (show-list (<span class="kw">cdr</span> lst)))))</a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7">(show-list &#39;((dig a pony) (doctor robert) (for you blue)))</a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co">; (DIG A PONY)</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="co">; (DOCTOR ROBERT)</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">; (FOR YOU BLUE)</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co">; DONE</span></a></code></pre></div>
<p><strong>How to abstract <code>show-list</code> into a higher order procedure? (We can’t call it a “higher-order function” because this one is for computations with side effects.)</strong></p>
<p>The procedure <code>for-each</code> is part of standard Scheme:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb15-1" title="1">(<span class="kw">for-each</span> show &#39;((mean mr mustard) (no reply) (tell me why)))</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co">; (MEAN MR MUSTARD)</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">; (NO REPLY)</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">; (TELL ME WHY)</span></a></code></pre></div>
<p>The value returned by <code>for-each</code> is unspecified.</p>
<p><strong>Why is that we use <code>for-each</code> instead of <code>map</code> to print each element of a list?</strong></p>
<p>There are two reasons. One is just an efficiency issue: <code>map</code> constructs a list containing the values returned by each of its sub-computations; in this example, it would be a list of three instances of the unspecified value returned by <code>show</code>. But we aren’t going to use that list for anything, so there’s no point in constructing it.</p>
<p>The second reason is more serious. <em>In functional programming, the order of evaluation of subexpressions is unspecified.</em> For example, when we evaluate the expression</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb16-1" title="1">(<span class="op">-</span> (<span class="op">+</span> <span class="dv">4</span> <span class="dv">5</span>) (* <span class="dv">6</span> <span class="dv">7</span>))</a></code></pre></div>
<p>we don’t know whether the addition or the multiplication happens first. Similarly, the order in which <code>map</code> computes the results for each element is unspecified. That’s okay as long as the ultimately returned list of results is in the right order. But when we are using side effects, we do care about the order of evaluation. In this case, we want to make sure that the elements of the argument list are printed from left to right. <code>for-each</code> guarantees this ordering.</p>
<hr />
<h3 id="tic-tac-toe-revisited">Tic-Tac-Toe Revisited</h3>
<p>We’re working up toward playing a game of tic-tac-toe against the computer. But as a first step, let’s have the computer play against itself.</p>
<p>What we already have is <code>ttt</code>, a strategy function: one that takes a board position as argument (and also a letter x or o ) and returns the chosen next move.</p>
<p><strong>How to define <code>stupid-ttt</code> as an alternative strategy?</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb17-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(stupid-ttt position letter)</a>
<a class="sourceLine" id="cb17-2" title="2">  (location &#39;_ position))</a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4">(<span class="ex">define</span><span class="fu"> </span>(location letter word)</a>
<a class="sourceLine" id="cb17-5" title="5">  (<span class="kw">if</span> (<span class="kw">equal?</span> letter (first word))</a>
<a class="sourceLine" id="cb17-6" title="6">      <span class="dv">1</span></a>
<a class="sourceLine" id="cb17-7" title="7">      (<span class="op">+</span> <span class="dv">1</span> (location letter (bf word)))))</a></code></pre></div>
<p><strong>How to write a program <code>play-ttt</code> that takes two strategies as arguments and plays a game between them?</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb18-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(play-ttt x-strat o-strat)</a>
<a class="sourceLine" id="cb18-2" title="2">  (play-ttt-helper x-strat o-strat &#39;_________ &#39;x))</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4">(<span class="ex">define</span><span class="fu"> </span>(play-ttt-helper x-strat o-strat position whose-turn)</a>
<a class="sourceLine" id="cb18-5" title="5">  (<span class="kw">cond</span> ((already-won? position (opponent whose-turn))</a>
<a class="sourceLine" id="cb18-6" title="6">         (<span class="kw">list</span> (opponent whose-turn) &#39;wins!))</a>
<a class="sourceLine" id="cb18-7" title="7">        ((tie-game? position) &#39;(tie game))</a>
<a class="sourceLine" id="cb18-8" title="8">        (<span class="kw">else</span> (<span class="kw">let</span> ((square (<span class="kw">if</span> (<span class="kw">equal?</span> whose-turn &#39;x)</a>
<a class="sourceLine" id="cb18-9" title="9">                                (x-strat position &#39;x)</a>
<a class="sourceLine" id="cb18-10" title="10">                                (o-strat position &#39;o))))</a>
<a class="sourceLine" id="cb18-11" title="11">                (play-ttt-helper x-strat</a>
<a class="sourceLine" id="cb18-12" title="12">                                 o-strat</a>
<a class="sourceLine" id="cb18-13" title="13">                                 (add-move square whose-turn position)</a>
<a class="sourceLine" id="cb18-14" title="14">                                 (opponent whose-turn))))))</a>
<a class="sourceLine" id="cb18-15" title="15"></a>
<a class="sourceLine" id="cb18-16" title="16">(<span class="ex">define</span><span class="fu"> </span>(already-won? position who)</a>
<a class="sourceLine" id="cb18-17" title="17">  (member? (word who who who) (find-triples position)))</a>
<a class="sourceLine" id="cb18-18" title="18"></a>
<a class="sourceLine" id="cb18-19" title="19">(<span class="ex">define</span><span class="fu"> </span>(tie-game? position)</a>
<a class="sourceLine" id="cb18-20" title="20">  (<span class="kw">not</span> (member? &#39;_ position)))</a></code></pre></div>
<p><strong>How to define <code>add-move</code>?</strong></p>
<p>The procedure <code>add-move</code> takes a square and an old position as arguments and returns the new position.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb19-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(add-move square letter position)</a>
<a class="sourceLine" id="cb19-2" title="2">  (<span class="kw">if</span> (<span class="op">=</span> square <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-3" title="3">      (word letter (bf position))</a>
<a class="sourceLine" id="cb19-4" title="4">      (word (first position)</a>
<a class="sourceLine" id="cb19-5" title="5">            (add-move (<span class="op">-</span> square <span class="dv">1</span>) letter (bf position)))))</a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7">(play-ttt ttt stupid-ttt)</a>
<a class="sourceLine" id="cb19-8" title="8"><span class="co">; (X WINS!)</span></a>
<a class="sourceLine" id="cb19-9" title="9"></a>
<a class="sourceLine" id="cb19-10" title="10">(play-ttt stupid-ttt ttt)</a>
<a class="sourceLine" id="cb19-11" title="11"><span class="co">; (O WINS!)</span></a></code></pre></div>
<hr />
<h3 id="accepting-user-input">Accepting User Input</h3>
<p><strong>How to define a strategy procedure <code>ask-user</code> that asks the user where to move?</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb20-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(ask-user position letter)</a>
<a class="sourceLine" id="cb20-2" title="2">  (print-position position)</a>
<a class="sourceLine" id="cb20-3" title="3">  (<span class="kw">display</span> letter)</a>
<a class="sourceLine" id="cb20-4" title="4">  (<span class="kw">display</span> <span class="st">&quot;’s move: &quot;</span>)</a>
<a class="sourceLine" id="cb20-5" title="5">  (<span class="kw">read</span>))</a>
<a class="sourceLine" id="cb20-6" title="6"></a>
<a class="sourceLine" id="cb20-7" title="7">(<span class="ex">define</span><span class="fu"> </span>(print-position position)    <span class="co">;; first version</span></a>
<a class="sourceLine" id="cb20-8" title="8">  (show position))</a>
<a class="sourceLine" id="cb20-9" title="9"></a>
<a class="sourceLine" id="cb20-10" title="10">(play-ttt ttt ask-user)</a>
<a class="sourceLine" id="cb20-11" title="11"><span class="co">; ____X____</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="co">; O’S MOVE: 1</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="co">; O___XX___</span></a>
<a class="sourceLine" id="cb20-14" title="14"><span class="co">; O’S MOVE: 4</span></a>
<a class="sourceLine" id="cb20-15" title="15"><span class="co">; O__OXXX__</span></a>
<a class="sourceLine" id="cb20-16" title="16"><span class="co">; O’S MOVE: 3</span></a>
<a class="sourceLine" id="cb20-17" title="17"><span class="co">; OXOOXXX__</span></a>
<a class="sourceLine" id="cb20-18" title="18"><span class="co">; O’S MOVE: 8</span></a>
<a class="sourceLine" id="cb20-19" title="19"><span class="co">; (TIE GAME)</span></a></code></pre></div>
<p>What the user typed is just the single digits shown in boldface at the ends of the lines.</p>
<p><strong>How does procedure <code>read</code> work?</strong></p>
<p><code>read</code> waits for you to type a Scheme expression, and returns that expression. Don’t be confused: <code>read</code> does not evaluate what you type. It returns exactly the same expression that you type:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb21-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(echo)</a>
<a class="sourceLine" id="cb21-2" title="2">  (<span class="kw">display</span> <span class="st">&quot;What? &quot;</span>)</a>
<a class="sourceLine" id="cb21-3" title="3">  (<span class="kw">let</span> ((expr (<span class="kw">read</span>)))</a>
<a class="sourceLine" id="cb21-4" title="4">    (<span class="kw">if</span> (<span class="kw">equal?</span> expr &#39;stop)</a>
<a class="sourceLine" id="cb21-5" title="5">        &#39;okay</a>
<a class="sourceLine" id="cb21-6" title="6">        (<span class="kw">begin</span></a>
<a class="sourceLine" id="cb21-7" title="7">         (show expr)</a>
<a class="sourceLine" id="cb21-8" title="8">         (echo)))))</a>
<a class="sourceLine" id="cb21-9" title="9"></a>
<a class="sourceLine" id="cb21-10" title="10">(echo)</a>
<a class="sourceLine" id="cb21-11" title="11"><span class="co">; What? hello</span></a>
<a class="sourceLine" id="cb21-12" title="12"><span class="co">; HELLO</span></a>
<a class="sourceLine" id="cb21-13" title="13"><span class="co">; What? (+ 2 3)</span></a>
<a class="sourceLine" id="cb21-14" title="14"><span class="co">; (+ 2 3)</span></a>
<a class="sourceLine" id="cb21-15" title="15"><span class="co">; What? (first (glass onion))</span></a>
<a class="sourceLine" id="cb21-16" title="16"><span class="co">; (FIRST (GLASS ONION))</span></a>
<a class="sourceLine" id="cb21-17" title="17"><span class="co">; What? stop</span></a>
<a class="sourceLine" id="cb21-18" title="18"><span class="co">; OKAY</span></a></code></pre></div>
<hr />
<h3 id="aesthetic-board-display">Aesthetic Board Display</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb22-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(print-position position)</a>
<a class="sourceLine" id="cb22-2" title="2">  (print-row (subword position <span class="dv">1</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb22-3" title="3">  (show <span class="st">&quot;-+-+-&quot;</span>)</a>
<a class="sourceLine" id="cb22-4" title="4">  (print-row (subword position <span class="dv">4</span> <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb22-5" title="5">  (show <span class="st">&quot;-+-+-&quot;</span>)</a>
<a class="sourceLine" id="cb22-6" title="6">  (print-row (subword position <span class="dv">7</span> <span class="dv">9</span>))</a>
<a class="sourceLine" id="cb22-7" title="7">  (<span class="kw">newline</span>))</a>
<a class="sourceLine" id="cb22-8" title="8"></a>
<a class="sourceLine" id="cb22-9" title="9">(<span class="ex">define</span><span class="fu"> </span>(print-row row)</a>
<a class="sourceLine" id="cb22-10" title="10">  (maybe-display (first row))</a>
<a class="sourceLine" id="cb22-11" title="11">  (<span class="kw">display</span> <span class="st">&quot;|&quot;</span>)</a>
<a class="sourceLine" id="cb22-12" title="12">  (maybe-display (first (bf row)))</a>
<a class="sourceLine" id="cb22-13" title="13">  (<span class="kw">display</span> <span class="st">&quot;|&quot;</span>)</a>
<a class="sourceLine" id="cb22-14" title="14">  (maybe-display (last row))</a>
<a class="sourceLine" id="cb22-15" title="15">  (<span class="kw">newline</span>))</a>
<a class="sourceLine" id="cb22-16" title="16"></a>
<a class="sourceLine" id="cb22-17" title="17">(<span class="ex">define</span><span class="fu"> </span>(maybe-display letter)</a>
<a class="sourceLine" id="cb22-18" title="18">  (<span class="kw">if</span> (<span class="kw">not</span> (<span class="kw">equal?</span> letter &#39;_))</a>
<a class="sourceLine" id="cb22-19" title="19">      (<span class="kw">display</span> letter)</a>
<a class="sourceLine" id="cb22-20" title="20">      (<span class="kw">display</span> <span class="st">&quot; &quot;</span>)))</a>
<a class="sourceLine" id="cb22-21" title="21"></a>
<a class="sourceLine" id="cb22-22" title="22">(<span class="ex">define</span><span class="fu"> </span>(subword wd start end)      <span class="co">; higher-order version</span></a>
<a class="sourceLine" id="cb22-23" title="23">  ((repeated bf (<span class="op">-</span> start <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb22-24" title="24">   ((repeated bl (<span class="op">-</span> (count wd) end))</a>
<a class="sourceLine" id="cb22-25" title="25">    wd)))</a>
<a class="sourceLine" id="cb22-26" title="26"></a>
<a class="sourceLine" id="cb22-27" title="27">(<span class="ex">define</span><span class="fu"> </span>(subword wd start end)</a>
<a class="sourceLine" id="cb22-28" title="28">  (<span class="kw">cond</span> ((<span class="op">&gt;</span> start <span class="dv">1</span>) (subword (bf wd) (<span class="op">-</span> start <span class="dv">1</span>) (<span class="op">-</span> end <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb22-29" title="29">        ((<span class="op">&lt;</span> end (count wd)) (subword (bl wd) start end))</a>
<a class="sourceLine" id="cb22-30" title="30">        (<span class="kw">else</span> wd)))</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb23-1" title="1">(print-position &#39;_x_oo__xx)</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="co">;  |X|</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="co">; -+-+-</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="co">; O|O|</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="co">; -+-+-</span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="co">;  |X|X</span></a></code></pre></div>
<hr />
<h3 id="reading-and-writing-normal-text">Reading and Writing Normal Text</h3>
<p><strong>When do we use <code>read</code>?</strong></p>
<p>The <code>read</code> procedure works fine as long as what you type looks like a Lisp program. That is, it <em>reads one expression at a time.</em></p>
<p><strong>How does <code>read-line</code> in simply.scm work?</strong></p>
<p>We’ve provided a procedure <code>read-line</code> that reads one line of input and returns a sentence. The words in that sentence will contain any punctuation characters that appear on the line, including parentheses, which are not interpreted as sublist delimiters by <code>read-line</code>. <code>read-line</code> also preserves the case of letters.</p>
<p><strong>How to define <code>music-critic</code> to read more than one word with <code>read-line</code>?</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb24-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(music-critic)</a>
<a class="sourceLine" id="cb24-2" title="2">  (read-line)</a>
<a class="sourceLine" id="cb24-3" title="3">  (show <span class="st">&quot;What’s your favorite Beatles song?&quot;</span>)</a>
<a class="sourceLine" id="cb24-4" title="4">  (<span class="kw">let</span> ((song (read-line)))</a>
<a class="sourceLine" id="cb24-5" title="5">    (show (se <span class="st">&quot;I like&quot;</span> song <span class="st">&quot;too.&quot;</span>))))</a>
<a class="sourceLine" id="cb24-6" title="6"></a>
<a class="sourceLine" id="cb24-7" title="7">(music-critic)</a>
<a class="sourceLine" id="cb24-8" title="8"><span class="co">; What’s your favorite Beatles song?</span></a>
<a class="sourceLine" id="cb24-9" title="9"><span class="co">; She Loves You</span></a>
<a class="sourceLine" id="cb24-10" title="10"><span class="co">; (I like She Loves You too.)</span></a></code></pre></div>
<p><strong>Why do we call <code>read-line</code> and ignores its result at the beginning of <code>music-critic</code>?</strong></p>
<p>It has to do with the interaction between <code>read-line</code> and <code>read</code>. <em><code>read</code> treats what you type as a sequence of Scheme expressions; each invocation of <code>read</code> reads one of them.</em> <code>read</code> pays no attention to formatting details, such as several consecutive spaces or line breaks. If, for example, you type several expressions on the same line, it will take several invocations of <code>read</code> to read them all.</p>
<p>By contrast, <em><code>read-line</code> treats what you type as a sequence of lines, reading one line per invocation, so it does pay attention to line breaks.</em></p>
<p>Either of these ways to read input is sensible in itself, but if you mix the two, by invoking <code>read</code> sometimes and <code>read-line</code> sometimes in the same program, the results can be confusing. Suppose you type a line containing an expression and your program invokes <code>read</code> to read it. Since there might have been another expression on the line, <code>read</code> doesn’t advance to the next line until you ask for the next expression. So if you now invoke <code>read-line</code>, thinking that it will read another line from the keyboard, it will instead return an empty list, because what it sees is an empty line—what’s left after <code>read</code> uses up the expression you typed.</p>
<p>You may be thinking, “But <code>music-critic</code> doesn’t call <code>read</code>!” That’s true, but Scheme itself used <code>read</code> to read the expression that you used to invoke <code>music-critic</code>. So the first invocation of <code>read-line</code> is needed to skip over the spurious empty line.</p>
<p>Our solution works only if <code>music-critic</code> is invoked directly at a Scheme prompt. If <code>music-critic</code> were a subprocedure of some larger program that has already called <code>read-line</code> before calling <code>music-critic</code>, the extra <code>read-line</code> in <code>music-critic</code> would really read and ignore a useful line of text.</p>
<p><strong>How to use <code>read-line</code>?</strong></p>
<p>If you write a procedure using read-line that will sometimes be called directly and sometimes be used as a subprocedure, you can’t include an extra read-line call in it. Instead, when you call your procedure directly from the Scheme prompt, you must say</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb25-1" title="1">(<span class="kw">begin</span> (read-line) (my-procedure))</a></code></pre></div>
<p>Another technical detail about <code>read-line</code> is that since it preserves the capitalization of words, its result may include strings, which will be shown in quotation marks if you return the value rather than <code>show</code>ing it:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb26-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(music-critic-return)</a>
<a class="sourceLine" id="cb26-2" title="2">  (read-line)</a>
<a class="sourceLine" id="cb26-3" title="3">  (show <span class="st">&quot;What’s your favorite Beatles song?&quot;</span>)</a>
<a class="sourceLine" id="cb26-4" title="4">  (<span class="kw">let</span> ((song (read-line)))</a>
<a class="sourceLine" id="cb26-5" title="5">    (se <span class="st">&quot;I like&quot;</span> song <span class="st">&quot;too.&quot;</span>)))</a>
<a class="sourceLine" id="cb26-6" title="6"></a>
<a class="sourceLine" id="cb26-7" title="7">(music-critic-return)</a>
<a class="sourceLine" id="cb26-8" title="8"><span class="co">; What’s your favorite Beatles song?</span></a>
<a class="sourceLine" id="cb26-9" title="9"><span class="co">; She Loves You</span></a>
<a class="sourceLine" id="cb26-10" title="10"><span class="co">; (&quot;I like&quot; &quot;She&quot; &quot;Loves&quot; &quot;You&quot; &quot;too.&quot;)</span></a></code></pre></div>
<p><strong>How does <code>show-line</code> work?</strong></p>
<p>We have also provided <code>show-line</code>, which takes a sentence as argument. It prints the sentence without surrounding parentheses, followed by a newline. (Actually, it takes any list as argument; it prints all the parentheses except for the outer ones.)</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb27-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(music-critic)</a>
<a class="sourceLine" id="cb27-2" title="2">  (read-line)</a>
<a class="sourceLine" id="cb27-3" title="3">  (show <span class="st">&quot;What’s your favorite Beatles song?&quot;</span>)</a>
<a class="sourceLine" id="cb27-4" title="4">  (<span class="kw">let</span> ((song (read-line)))</a>
<a class="sourceLine" id="cb27-5" title="5">    (show-line (se <span class="st">&quot;I like&quot;</span> song <span class="st">&quot;too.&quot;</span>))))</a>
<a class="sourceLine" id="cb27-6" title="6"></a>
<a class="sourceLine" id="cb27-7" title="7">(music-critic)</a>
<a class="sourceLine" id="cb27-8" title="8"><span class="co">; What’s your favorite Beatles song?</span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="co">; She Loves You</span></a>
<a class="sourceLine" id="cb27-10" title="10"><span class="co">; I like She Loves You too.</span></a></code></pre></div>
<p>The difference between <code>show</code> and <code>show-line</code> isn’t crucial. It’s just a matter of a pair of parentheses. The point is that <code>read-line</code> and <code>show-line</code> go together. <code>read-line</code> reads a bunch of disconnected words and combines them into a sentence. <code>show-line</code> takes a sentence and prints it as if it were a bunch of disconnected words.</p>
<hr />
<h3 id="formatted-text">Formatted Text</h3>
<p><strong>What are the two common applications of sequential printing?</strong></p>
<ul>
<li>Explicit printing instructions for the sake of conversational programs</li>
<li>Display tabular information, such as columns of numbers</li>
</ul>
<p><strong>How to create numeric tables with <code>align</code> function?</strong></p>
<p>The <code>align</code> function can be used to convert a number to a printable word with a fixed number of positions before and after the decimal point:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb28-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(square-root-table nums)</a>
<a class="sourceLine" id="cb28-2" title="2">  (<span class="kw">if</span> (<span class="kw">null?</span> nums)</a>
<a class="sourceLine" id="cb28-3" title="3">      &#39;done</a>
<a class="sourceLine" id="cb28-4" title="4">      (<span class="kw">begin</span> (<span class="kw">display</span> (align (<span class="kw">car</span> nums) <span class="dv">7</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb28-5" title="5">             (show (align (<span class="kw">sqrt</span> (<span class="kw">car</span> nums)) <span class="dv">10</span> <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb28-6" title="6">             (square-root-table (<span class="kw">cdr</span> nums)))))</a>
<a class="sourceLine" id="cb28-7" title="7"></a>
<a class="sourceLine" id="cb28-8" title="8">(square-root-table &#39;(<span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> <span class="dv">10</span> <span class="dv">20</span> <span class="dv">98</span> <span class="dv">99</span> <span class="dv">100</span> <span class="dv">101</span> <span class="dv">1234</span> <span class="dv">56789</span>))</a>
<a class="sourceLine" id="cb28-9" title="9"><span class="co">;     7.0     2.64575</span></a>
<a class="sourceLine" id="cb28-10" title="10"><span class="co">;     8.0     2.82843</span></a>
<a class="sourceLine" id="cb28-11" title="11"><span class="co">;     9.0     3.00000</span></a>
<a class="sourceLine" id="cb28-12" title="12"><span class="co">;    10.0     3.16228</span></a>
<a class="sourceLine" id="cb28-13" title="13"><span class="co">;    20.0     4.47214</span></a>
<a class="sourceLine" id="cb28-14" title="14"><span class="co">;    98.0     9.89949</span></a>
<a class="sourceLine" id="cb28-15" title="15"><span class="co">;    99.0     9.94987</span></a>
<a class="sourceLine" id="cb28-16" title="16"><span class="co">;   100.0    10.00000</span></a>
<a class="sourceLine" id="cb28-17" title="17"><span class="co">;   101.0    10.04988</span></a>
<a class="sourceLine" id="cb28-18" title="18"><span class="co">;  1234.0    35.12834</span></a>
<a class="sourceLine" id="cb28-19" title="19"><span class="co">; 56789.0   238.30443</span></a>
<a class="sourceLine" id="cb28-20" title="20"><span class="co">; DONE</span></a></code></pre></div>
<p><strong>How does <code>align</code> work?</strong></p>
<p><code>align</code> takes three arguments. The first is the value to be displayed. The second is the width of the column in which it will be displayed; the returned value will be a word with that many characters in it. The third argument is the number of digits that should be displayed to the right of the decimal point. (If this number is zero, then no decimal point will be displayed.) The width must be great enough to include all the digits, as well as the decimal point and minus sign, if any.</p>
<p>As the program example above indicates, <code>align</code> does not print anything. It’s a function that returns a value suitable for printing with <code>display</code> or <code>show</code> .</p>
<p><strong>What if the number is too big to fit in the available space?</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb29-1" title="1">(align <span class="dv">12345679</span> <span class="dv">4</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb29-2" title="2"><span class="co">; &quot;123+&quot;</span></a></code></pre></div>
<p><code>align</code> returns a word containing the first few digits, as many as fit, ending with a plus sign to indicate that part of the value is missing.</p>
<p><strong>How to create a non-numeric text table with <code>align</code> function?</strong></p>
<p><code>align</code> can also be used to include non-numeric text in columns. If the first argument is not a number, then only two arguments are needed; the second is the column width.</p>
<p>In this case <code>align</code> returns a word with extra spaces at the right, if necessary, so that the argument word will appear at the left in its column:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb30-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(name-table names)</a>
<a class="sourceLine" id="cb30-2" title="2">  (<span class="kw">if</span> (<span class="kw">null?</span> names)</a>
<a class="sourceLine" id="cb30-3" title="3">      &#39;done</a>
<a class="sourceLine" id="cb30-4" title="4">      (<span class="kw">begin</span> (<span class="kw">display</span> (align (<span class="kw">cadar</span> names) <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb30-5" title="5">             (show (<span class="kw">caar</span> names))</a>
<a class="sourceLine" id="cb30-6" title="6">             (name-table (<span class="kw">cdr</span> names)))))</a>
<a class="sourceLine" id="cb30-7" title="7"></a>
<a class="sourceLine" id="cb30-8" title="8">(name-table &#39;((john lennon) (paul mccartney)</a>
<a class="sourceLine" id="cb30-9" title="9">              (george harrison) (ringo starr)))</a>
<a class="sourceLine" id="cb30-10" title="10"><span class="co">; LENNON     JOHN</span></a>
<a class="sourceLine" id="cb30-11" title="11"><span class="co">; MCCARTNEY  PAUL</span></a>
<a class="sourceLine" id="cb30-12" title="12"><span class="co">; HARRISON   GEORGE</span></a>
<a class="sourceLine" id="cb30-13" title="13"><span class="co">; STARR      RINGO</span></a>
<a class="sourceLine" id="cb30-14" title="14"><span class="co">; DONE</span></a></code></pre></div>
<p>As with numbers, if a non-numeric word won’t fit in the allowed space, <code>align</code> returns a partial word ending with a plus sign.</p>
<p>This <code>align</code> function is not part of standard Scheme. Most programming languages, including some versions of Scheme, offer much more elaborate formatting capabilities with many alternate ways to represent both numbers and general text.</p>
<hr />
<h3 id="sequential-programming-and-order-of-evaluation">Sequential Programming and Order of Evaluation</h3>
<p><strong>What is the obvious concern about order of events in sequential programming?</strong></p>
<p>The obvious concern about order of events is that sequences of <code>show</code> expressions must come in the order in which we want them to appear, and <code>read</code> expressions must fit into the sequence properly so that the user is asked for the right information at the right time.</p>
<p><strong>What is the less obvious concern about order of events in sequential programming?</strong></p>
<p>There is another, less obvious issue about order of events. When <em>the evaluation of expressions can have side effects in addition to returning values</em>, the order of evaluation of argument subexpressions becomes important.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb31-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(show-and-return x)</a>
<a class="sourceLine" id="cb31-2" title="2">(show x)</a>
<a class="sourceLine" id="cb31-3" title="3">x)</a>
<a class="sourceLine" id="cb31-4" title="4"></a>
<a class="sourceLine" id="cb31-5" title="5">(<span class="kw">list</span> (show-and-return (<span class="op">+</span> <span class="dv">3</span> <span class="dv">4</span>)) (show-and-return (<span class="op">-</span> <span class="dv">10</span> <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb31-6" title="6"><span class="co">; 8</span></a>
<a class="sourceLine" id="cb31-7" title="7"><span class="co">; 7</span></a>
<a class="sourceLine" id="cb31-8" title="8"><span class="co">; (7 8)</span></a></code></pre></div>
<p>(We’ve shown the case of right-to-left computation; your Scheme might be different.)</p>
<p>Suppose you want to make sure that the seven prints first, regardless of which order your Scheme uses. You could do this:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb32-1" title="1">(<span class="kw">let</span> ((left (show-and-return (<span class="op">+</span> <span class="dv">3</span> <span class="dv">4</span>))))</a>
<a class="sourceLine" id="cb32-2" title="2">  (<span class="kw">list</span> left (show-and-return (<span class="op">-</span> <span class="dv">10</span> <span class="dv">2</span>))))</a>
<a class="sourceLine" id="cb32-3" title="3"><span class="co">; 7</span></a>
<a class="sourceLine" id="cb32-4" title="4"><span class="co">; 8</span></a>
<a class="sourceLine" id="cb32-5" title="5"><span class="co">; (7 8)</span></a></code></pre></div>
<p>The expression in the body of a <code>let</code> can’t be evaluated until the <code>let</code> variables (such as <code>left</code>) have had their values computed.</p>
<p><strong>How can the order of events be a concern when we use <code>read</code>?</strong></p>
<p>Suppose we want to write a procedure to ask a person for his or her full name, returning a two-element list containing the first and last name. A natural mistake to make would be to write this procedure:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb33-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(ask-for-name)                                         <span class="co">;; wrong</span></a>
<a class="sourceLine" id="cb33-2" title="2">  (show <span class="st">&quot;Please type your first name, then your last name:&quot;</span>)</a>
<a class="sourceLine" id="cb33-3" title="3">  (<span class="kw">list</span> (<span class="kw">read</span>) (<span class="kw">read</span>)))</a>
<a class="sourceLine" id="cb33-4" title="4"></a>
<a class="sourceLine" id="cb33-5" title="5">(ask-for-name)</a>
<a class="sourceLine" id="cb33-6" title="6"><span class="co">; Please type your first name, then your last name:</span></a>
<a class="sourceLine" id="cb33-7" title="7"><span class="co">; John</span></a>
<a class="sourceLine" id="cb33-8" title="8"><span class="co">; Lennon</span></a>
<a class="sourceLine" id="cb33-9" title="9"><span class="co">; (LENNON JOHN)</span></a></code></pre></div>
<p>What went wrong? We happen to be using a version of Scheme that evaluates argument subexpressions from right to left. Therefore, the word <code>John</code> was read by the rightmost call to <code>read</code> , which provided the second argument to <code>list</code>.</p>
<p>The best solution is to use <code>let</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb34-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(ask-for-name)</a>
<a class="sourceLine" id="cb34-2" title="2">  (show <span class="st">&quot;Please type your first name, then your last name:&quot;</span>)</a>
<a class="sourceLine" id="cb34-3" title="3">  (<span class="kw">let</span> ((first-name (<span class="kw">read</span>)))</a>
<a class="sourceLine" id="cb34-4" title="4">    (<span class="kw">list</span> first -name (<span class="kw">read</span>))))</a></code></pre></div>
<p>Even this example looks artificially simple, because of the two invocations of <code>read</code> that are visibly right next to each other in the erroneous version. But look at <code>play-ttt-helper</code>. The word <code>read</code> doesn’t appear in its body at all. But when we invoke it using <code>ask-user</code> as the strategy procedure for <code>x</code>, the expression</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb35-1" title="1">(x-strat position &#39;x)</a></code></pre></div>
<p>hides an invocation of <code>read</code>. The structure of <code>play-ttt-helper</code> includes a <code>let</code> that controls the timing of that read. (As it turns out, in this particular case we could have gotten away with writing the program without <code>let</code>. The hidden invocation of <code>read</code> is the only subexpression with a side effect, so there aren’t two effects that might get out of order. But we had to think carefully about the program to be sure of that.)</p>
<hr />
<h3 id="pitfalls">Pitfalls</h3>
<ul>
<li>It’s easy to get confused about what is printed explicitly by your program and what is printed by Scheme’s read-eval-print loop. Until now, all printing was of the second kind. Here’s an example that doesn’t do anything very interesting but will help make the point clear:</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb36-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(name)</a>
<a class="sourceLine" id="cb36-2" title="2">  (<span class="kw">display</span> <span class="st">&quot;MATT &quot;</span>)</a>
<a class="sourceLine" id="cb36-3" title="3">  &#39;wright)</a>
<a class="sourceLine" id="cb36-4" title="4"></a>
<a class="sourceLine" id="cb36-5" title="5">(name)</a>
<a class="sourceLine" id="cb36-6" title="6"><span class="co">; MATT WRIGHT</span></a></code></pre></div>
<p>At first glance it looks as if putting the word “Matt” inside a call to <code>display</code> is unnecessary. After all, the word <code>wright</code> is printed even without using <code>display</code>. But watch this:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb37-1" title="1">(bf (name))</a>
<a class="sourceLine" id="cb37-2" title="2"><span class="co">; MATT RIGHT</span></a></code></pre></div>
<p>Every time you invoke <code>name</code>, whether or not as the entire expression used at a Scheme prompt, the word <code>MATT</code> is printed. But the word <code>wright</code> is returned, and may or may not be printed depending on the context in which <code>name</code> is invoked.</p>
<ul>
<li><p>A sequence of expressions returns the value of the <em>last</em> expression. If that isn’t what you want, you must remember the value you want to return using <code>let</code>:</p></li>
<li><p>Don’t forget that the first call to <code>read-line</code>, or any call to <code>read-line</code> after a call to <code>read</code> , will probably read the empty line that <code>read</code> left behind.</p></li>
<li><p>Sometimes you want to use what the user typed more than once in your program. But don’t forget that <code>read</code> has an effect as well as a return value. Don’t try to read the same expression twice:</p></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb38-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(ask-question question)           <span class="co">;; wrong</span></a>
<a class="sourceLine" id="cb38-2" title="2">  (show question)</a>
<a class="sourceLine" id="cb38-3" title="3">  (<span class="kw">cond</span> ((<span class="kw">equal?</span> (<span class="kw">read</span>) &#39;yes) <span class="dv">#t</span>)</a>
<a class="sourceLine" id="cb38-4" title="4">        ((<span class="kw">equal?</span> (<span class="kw">read</span>) &#39;no) <span class="dv">#f</span>)</a>
<a class="sourceLine" id="cb38-5" title="5">        (<span class="kw">else</span> (show <span class="st">&quot;Please answer yes or no.&quot;</span>)</a>
<a class="sourceLine" id="cb38-6" title="6">              (ask-question question))))</a></code></pre></div>
<p>If the answer is <code>yes</code>, this procedure will work fine. But if not, the second invocation of <code>read</code> will read a second expression, not test the same expression again as intended. To avoid this problem, invoke <code>read</code> only once for each expression you want to read, and use <code>let</code> to remember the result:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode scheme"><code class="sourceCode scheme"><a class="sourceLine" id="cb39-1" title="1">(<span class="ex">define</span><span class="fu"> </span>(ask-question question)</a>
<a class="sourceLine" id="cb39-2" title="2">  (show question)</a>
<a class="sourceLine" id="cb39-3" title="3">  (<span class="kw">let</span> ((answer (<span class="kw">read</span>)))</a>
<a class="sourceLine" id="cb39-4" title="4">    (<span class="kw">cond</span> ((<span class="kw">equal?</span> answer &#39;yes) <span class="dv">#t</span>)</a>
<a class="sourceLine" id="cb39-5" title="5">          ((<span class="kw">equal?</span> answer &#39;no) <span class="dv">#f</span>)</a>
<a class="sourceLine" id="cb39-6" title="6">          (<span class="kw">else</span> (show <span class="st">&quot;Please answer yes or no.&quot;</span>)</a>
<a class="sourceLine" id="cb39-7" title="7">                (ask-question question)))))</a></code></pre></div>
<hr />
<h3 id="exercises-20.1-20.3">Exercises 20.1-20.3</h3>
<p><a href="">solutions</a></p>
<h3 id="exercises-20.4-20.9">Exercises 20.4-20.9</h3>
<p><a href="">solutions</a></p>
<hr />
</body>
</html>
